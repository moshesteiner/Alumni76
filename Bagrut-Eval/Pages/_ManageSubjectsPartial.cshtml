@model UsersPageModel.ManageSubjectsViewModel

<form id="updateSubjectsForm">
    <input type="hidden" id="modalSubjectUserId" value="@Model.UserId" />

    <div id="subjectAssignmentsContainer">
        @if (Model.SubjectAssignments.Any())
        {
            @foreach (var assignment in Model.SubjectAssignments)
            {
                <div class="d-flex align-items-center mb-2">
                    <div class="form-check me-3">
                        <input class="form-check-input subject-checkbox" type="checkbox"
                               id="modal_subject_@assignment.SubjectId"
                               data-subject-id="@assignment.SubjectId"
                               @if (assignment.IsAssigned) { <text>checked</text> }> 
                        <label class="form-check-label" for="modal_subject_@assignment.SubjectId">
                            @assignment.Title
                        </label>
                    </div>

                    <div class="ms-auto" style="min-width: 150px;">
                        <select class="form-select subject-role-selector"
                                data-subject-id="@assignment.SubjectId"
                                id="role_select_@assignment.SubjectId"
                                @if (!assignment.IsAssigned) { <text>disabled</text> }> 
                            
                            @foreach (var role in Model.AvailableRoles)
                            {
                                @if (role == assignment.CurrentRole)
                                {
                                    <option value="@role" selected>@role</option>
                                }
                                else
                                {
                                    <option value="@role">@role</option>
                                }                                
                            }
                        </select>
                    </div>
                </div>
            }
        }
        else
        {
            <p>אין מקצועות זמינים</p>
        }
    </div>
</form>

<script>
    // Enable/Disable the role selector based on the checkbox state
    document.querySelectorAll('.subject-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            const subjectId = this.dataset.subjectId;
            const roleSelector = document.getElementById(`role_select_${subjectId}`);
            if (roleSelector) {
                roleSelector.disabled = !this.checked;
            }
        });
    });
</script>