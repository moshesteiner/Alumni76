@page
@model Bagrut_Eval.Pages.Metrics.ConfirmUploadMetricsModel
@using Bagrut_Eval.Utilities;

@{
    ViewData["Title"] = "Confirm Metrics Upload";
}

<h1>Confirm Metrics Upload</h1>

@* Display messages *@
@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success">@TempData["SuccessMessage"]</div>
}
@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger">@TempData["ErrorMessage"]</div>
}
@if (TempData["WarningMessage"] != null)
{
    <div class="alert alert-warning">@TempData["WarningMessage"]</div>
}

@if (Model.ExamId > 0 && Model.ParsedNewMetrics.Any())
{
    <div class="alert alert-warning">
        <p>Metrics already exist for **@Model.ExamTitle (ID: @Model.ExamId)**. What would you like to do?</p>
        <p>You are about to upload **@Model.ParsedNewMetrics.Count** new metric lines.</p>
    </div>

    <form method="post">
        @* Hidden fields to pass context back to OnPostAsync *@
        <input type="hidden" asp-for="ExamId" />
        <input type="hidden" name="metricsSessionKey" value="@(Model.MetricsSessionKey)" />

        <div class="form-group">
            @foreach (var action in Enum.GetValues(typeof(ConfirmUploadMetricsModel.UploadConflictAction)))
            {
                <div class="form-check">
                    <input class="form-check-input" type="radio" asp-for="ChosenAction" id="action@(action)" value="@action" required>
                    <label class="form-check-label" for="action@(action)">
                        @((action as Enum)!.GetDisplayName())
                    </label>
                </div>
            }
        </div>

        <button type="submit" class="btn btn-primary mt-3">Confirm Action</button>
        <a asp-page="/Metrics/UploadMetrics" class="btn btn-secondary mt-3">Back to Upload</a>
    </form>
}
else
{
    <p>No metrics data to confirm or exam not specified. Please go back and upload a file.</p>
    <a asp-page="/Metrics/UploadMetrics" class="btn btn-secondary mt-3">Back to Upload</a>
}

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
