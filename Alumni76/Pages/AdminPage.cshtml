@page
@model AdminPageModel
@{
    ViewData["Title"] = "ניהול בוגרים";
    var classOptions = new List<string> { "", "יב-1", "יב-2", "יב-3", "יב-4", "יב-5" };
}


@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show mt-3 mx-4" role="alert">
        @Html.Raw(TempData["SuccessMessage"])
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}
@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show mt-3 mx-4" role="alert">
        @TempData["ErrorMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}
<div class="full-width-content main-container">
    <div class="buttunBox">
        <br />
            <button type="button" class="btn btn-primary filter-button" data-bs-toggle="modal" data-bs-target="#filterSortModal">
                סינון
            </button>
            <br />
            <form method="post" asp-page-handler="ResetSort" class="d-inline">
                <button type="submit" class="btn btn-primary filter-button">איפוס</button>
            </form>
        <br /><br /><br /><br />
        <div id="countersBox">
            <h3>בוגרים</h3><h5> @Model.CountAllUsers / @Model.CountActiveUsers</h5><br />
            <h3>מגיעים</h3><h5>@Model.CountParticipants</h5>
        </div>
    </div>
    <div class="userTable">
        <table class="table table-sm table-bordered user-table-compact">
            <thead>
                <tr style="background-color: #a0a0a0;">
                    <th style="width: 50px;">פעיל</th>
                    <th width="2%"></th>
                    <th width="6%">שם פרטי</th>
                    <th style="width: 8%;">שם משפחה</th>
                    <th style="width: 8%;">שם נעורים</th>
                    <th style="width: 6%;">כינוי</th>
                    <th style="width: 80px;">כיתה</th>
                    <th>טלפון 1</th>
                    <th>טלפון 2</th>
                    <th style="width: 15%;">אימייל</th>
                    <th>כתובת</th>
                    <th style="width: 70px;">משתתף</th>
                    <th style="width: 70px;">שמירה</th>
                    <th width="70px">סיסמה</th>
                </tr>
            </thead>
            <tbody>
                @{
                    var line = 1;
                }
                @foreach (var user in Model.Users)
                {
                    <tr>
                        <form method="post" asp-page-handler="SaveUser">
                            @Html.AntiForgeryToken()

                            @* This hidden input maps to userUpdate.UserId *@
                            <input type="hidden" name="UserId" value="@user.UserId" />
                        <td class="text-center">
                            <div class="form-check form-switch d-flex justify-content-center">
                                @* Note: value="true" and a hidden input for false is required for bool binding *@
                                <input class="form-check-input" type="checkbox" name="Active" value="true" @(user.Active ? "checked" : "")>
                                <input type="hidden" name="Active" value="false" />
                            </div>
                        </td>
                        <td>@(line++)</td>
                        <td><input name="FirstName" value="@user.FirstName" class="form-control form-control-sm" /></td>
                        <td><input name="LastName" value="@user.LastName" class="form-control form-control-sm" /></td>
                        <td><input name="MaidenName" value="@user.MaidenName" class="form-control form-control-sm" /></td>
                        <td><input name="NickName" value="@user.NickName" class="form-control form-control-sm" /></td>
                        <td>
                            <select name="Class" class="form-select form-select-sm">
                                @foreach (var opt in classOptions)
                                {
                                    <option value="@opt" selected="@(user.Class == opt)">@opt</option>
                                }
                            </select>
                        </td>
                        <td><input name="Phone1" value="@user.Phone1" class="form-control form-control-sm" /></td>
                        <td><input name="Phone2" value="@user.Phone2" class="form-control form-control-sm" /></td>
                        <td style="direction: ltr;"><input name="Email" value="@user.Email" class="form-control form-control-sm" /></td>
                        <td><input name="Address" value="@user.Address" class="form-control form-control-sm" /></td>
                        <td class="text-center">
                            <div class="form-check form-switch d-flex justify-content-center">
                                <input class="form-check-input" type="checkbox" name="Participate" value="true" @(user.Participate ? "checked" : "")>
                                <input type="hidden" name="Participate" value="false" />
                            </div>
                        </td>
                        <td>
                            <button type="submit" class="btn btn-sm btn-success w-100">שמור</button>
                        </td>
                        </form>
                        <td>
                            <form method="post" asp-page-handler="ResetPassword">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="userId" value="@user.UserId" />
                                <button type="submit" class="btn btn-warning btn-sm"
                                        onclick="return confirm('האם אתה בטוח שברצונך לאפס את הסיסמה עבור @user.FirstName @user.LastName?');">
                                    איפוס סיסמה
                                </button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<style>
    .main-container {
        display: flex;
        width: 100%;
        padding: 0;
        margin: 0;
    }

    .buttunBox {
        flex: 1;
        direction: rtl;
    }

    .filter-button {
        margin: 40px 0px 0px 20px;
    }

    .userTable {
        flex: 20;
        padding: 0px 20px;
    }

    .user-table-compact {
        table-layout: fixed; /* [cite: 33] */
        width: 100%;
    }

    .form-control-sm, .form-select-sm {
        padding: 2px 5px;
        font-size: 1.3rem !important;
    }

    .user-table-compact thead th {
        background-color: #a0a0a0 !important;
        color: white;
        text-align: center;
        /* FIXES: */
        padding: 12px 5px !important; /* Adds vertical room */
        vertical-align: middle !important;
        height: 50px; /* Optional: forces a specific minimum height */
    }

    /* Centers the checkboxes and buttons vertically in the row */
    .user-table-compact td {
        vertical-align: middle !important;
    }

    .form-check-input {
        cursor: pointer;
    }
    #countersBox{
        border-width:1px;
        border-style:ridge;
        background-color:lightcyan; 
        text-align:center;
        padding-top:20px;
        padding-bottom:20px;
    }
</style>
@section Scripts {
    @await Html.PartialAsync("_FilterDialog", Model.FilterModel)
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}